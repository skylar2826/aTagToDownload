<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body></body>
</html>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>利用a标签实现下载</title>
    <style>
      a {
        text-decoration: none;
      }
      ul {
        border: 1px solid #ccc;
        margin: 16px, 0;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    html a标签实现下载：
    <ul>
      <!-- download指明是下载操作；
        若未指明download, 若文件类型是浏览器可解析文件，比如pdf、png、txt等，则浏览器会采取预览模式，打开文件；
        若文件类型无法解析，如exe,则走下载; -->
      <!-- rel: noopener 保证安全打开新链接, 相关资料 https://mathiasbynens.github.io/rel-noopener/ -->
      <li>
        未指明download, pdf文件类型可解析，走预览模式:
        <a href="/1.pdf" rel="noopener">1.pdf 预览</a>
      </li>
      <li>
        指明download, 走下载:
        <a href="/1.pdf" download rel="noopener">1.pdf 下载</a>
      </li>
      <li>
        修改下载名称:
        <a href="/1.pdf" download="2.pdf" rel="noopener"
          >1.pdf 下载名称改为2.pdf</a
        >
      </li>
      <li>
        未指明download, exe文件类型不可解析，走下载:
        <a href="/1.exe" rel="noopener">1.exe 下载</a>
      </li>
    </ul>

    js 创建a标签实现下载： 常见使用场景:
    使用组件库封装组件,但需要在某组件click时触发下载操作;
    由于组件被封装,不能通过添加html标签形式实现下载.
    <ul>
      <li onclick="downloadFile()">1.pdf 下载</li>
      <li onclick="downloadFile('2.pdf')">1.pdf 下载名称改为2.pdf</li>
    </ul>

    非同源文件下载：
    下载非同源文件时，download属性失效。download失效后，行为表现：浏览器不能解析的文件走下载，能解析的文件走解析;
    <!-- 详见：https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/a -->
    尽管HTTP URL需要同源，但可以使用blob:URL，和data：URL生存缓存url进行统一下载
    <!-- blob相关资料：https://juejin.cn/post/7213642622073552953 -->
    <ul>
      <li>
        <a href="http://127.0.0.1:5501/1.exe" download rel="noopener"
          >1.exe 下载非同源文件 不能解析走下载</a
        >
      </li>
      <li>
        <a href="http://127.0.0.1:5501/1.pdf" download rel="noopener"
          >1.pdf 下载非同源文件 能解析走预览</a
        >
      </li>
      <li onclick="downloadAsyncFile()">1.pdf 下载非同源文件</li>
    </ul>
    <script>
      function downloadFile(rename) {
        const aTag = document.createElement("a");
        aTag.href = "/1.pdf";
        aTag.rel = "noopener";
        // download=''取文件原名称
        aTag.download = "";
        if (rename) {
          // 修改下载名称:
          aTag.download = rename;
        }
        document.body.appendChild(aTag);
        aTag.click();
        aTag.remove();
      }
      function downloadAsyncFile() {
        const xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
          // readyState: 0-请求未初始化, 1-服务器连接已建立, 2-请求已接收, 3-请求处理中, 4-请求已完成,且响应已就绪
          // 详见：https://www.runoob.com/ajax/ajax-xmlhttprequest-onreadystatechange.html
          if (xhr.readyState === 4 && xhr.status === 200) {
            const blob = new Blob([xhr.responseText]);
            const aTag = document.createElement("a");
            // 记得在不需要这个url时，主动销毁url: revokeObjectURL()
            aTag.href = URL.createObjectURL(blob);
            aTag.rel = "noopener";
            aTag.download='新名字.pdf'
            document.body.appendChild(aTag);
            aTag.click();
            aTag.remove();
          }
        };
        xhr.open("GET", "http://127.0.0.1:5501/1.pdf", true);
        xhr.send();
      }
    </script>
  </body>
</html>
